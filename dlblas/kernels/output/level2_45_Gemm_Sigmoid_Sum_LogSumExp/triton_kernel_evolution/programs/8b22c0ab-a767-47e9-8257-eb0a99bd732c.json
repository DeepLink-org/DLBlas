{"id": "8b22c0ab-a767-47e9-8257-eb0a99bd732c", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport math\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef _fused_linear_sigmoid_sum(\n    x_ptr, w_ptr, b_ptr, output_ptr, \n    batch_size, input_size, hidden_size,\n    BLOCK_SIZE: tl.constexpr\n):\n    pid = tl.program_id(0)\n    if pid >= batch_size:\n        return\n    \n    row_sum = 0.0\n    for j in range(0, hidden_size):\n        offsets = tl.arange(0, BLOCK_SIZE)\n        mask = offsets < input_size\n        \n        x_i = tl.load(x_ptr + pid * input_size + offsets, mask=mask, other=0.0)\n        w_j = tl.load(w_ptr + j * input_size + offsets, mask=mask, other=0.0)\n        \n        dot = tl.sum(x_i * w_j)\n        bias_j = tl.load(b_ptr + j)\n        dot += bias_j\n        s = 1.0 / (1.0 + tl.exp(-dot))\n        row_sum += s\n    \n    tl.store(output_ptr + pid, row_sum)\n\n@triton.jit\ndef _logsumexp(\n    input_ptr, output_ptr, n, \n    BLOCK_SIZE: tl.constexpr\n):\n    pid = tl.program_id(0)\n    if pid >= 1:\n        return\n    \n    offsets = tl.arange(0, BLOCK_SIZE)\n    mask = offsets < n\n    x = tl.load(input_ptr + offsets, mask=mask, other=-3e38)\n    \n    max_val = tl.max(x, axis=0)\n    exp_x = tl.exp(x - max_val)\n    sum_exp = tl.sum(exp_x, axis=0)\n    log_sum_exp = tl.log(sum_exp) + max_val\n    \n    tl.store(output_ptr, log_sum_exp)\n\nclass ModelNew(nn.Module):\n    def __init__(self, input_size, hidden_size, output_size):\n        super(ModelNew, self).__init__()\n        self.linear1 = nn.Linear(input_size, hidden_size)\n        self.linear2 = nn.Linear(hidden_size, output_size)\n    \n    def forward(self, x):\n        batch_size, input_size = x.shape\n        hidden_size = self.linear1.weight.shape[0]\n        \n        x = x.contiguous()\n        w = self.linear1.weight.contiguous()\n        b = self.linear1.bias.contiguous()\n        \n        output_stage1 = torch.empty(batch_size, device=x.device, dtype=torch.float32)\n        grid1 = (batch_size,)\n        BLOCK_SIZE_INPUT = triton.next_power_of_2(input_size)\n        _fused_linear_sigmoid_sum[grid1](\n            x, w, b, output_stage1, \n            batch_size, input_size, hidden_size,\n            BLOCK_SIZE=BLOCK_SIZE_INPUT\n        )\n        \n        output_stage2 = torch.empty(1, device=x.device, dtype=torch.float32)\n        grid2 = (1,)\n        BLOCK_SIZE_BATCH = triton.next_power_of_2(batch_size)\n        _logsumexp[grid2](\n            output_stage1, output_stage2, batch_size, \n            BLOCK_SIZE=BLOCK_SIZE_BATCH\n        )\n        \n        return output_stage2[0]\n\nbatch_size = 128\ninput_size = 10\nhidden_size = 20\noutput_size = 5\n\ndef get_inputs():\n    return [torch.randn(batch_size, input_size)]\n\ndef get_init_inputs():\n    return [input_size, hidden_size, output_size]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "ff4ad061-5492-4c89-8646-5e0d763d7c86", "generation": 3, "timestamp": 1754575248.4112537, "iteration_found": 19, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": true, "score": 56.1, "speed_up": 1.361, "runtime_ms": 0.0808, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:6", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.11, "speed_up": 1.361, "custom_timing": 0.0808}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": false, "correctness": false, "score": -100.0, "stage": "no_valid_triton_code", "feedback": "You need to generate real and valid triton code for the core function. The key word 'import triton' is not found."}, "island": 1}, "artifacts_json": null, "artifact_dir": null}