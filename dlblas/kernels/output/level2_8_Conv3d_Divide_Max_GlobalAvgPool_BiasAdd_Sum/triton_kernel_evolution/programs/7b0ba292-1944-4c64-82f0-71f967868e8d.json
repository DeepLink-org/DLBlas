{"id": "7b0ba292-1944-4c64-82f0-71f967868e8d", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef _global_avg_pool3d(\n    x_ptr,\n    out_ptr,\n    batch_size,\n    C,\n    D, H, W,\n    x_stride_b, x_stride_c, x_stride_d, x_stride_h, x_stride_w,\n    BLOCK_SIZE: tl.constexpr,\n):\n    pid_b = tl.program_id(0)\n    pid_c = tl.program_id(1)\n    if pid_b >= batch_size or pid_c >= C:\n        return\n\n    total = 0.0\n    numel = D * H * W\n    for d in range(D):\n        for h in range(H):\n            for w in range(W):\n                offset = pid_b * x_stride_b + pid_c * x_stride_c + d * x_stride_d + h * x_stride_h + w * x_stride_w\n                total += tl.load(x_ptr + offset)\n    \n    avg = total / numel\n    out_index = pid_b * C + pid_c\n    tl.store(out_ptr + out_index, avg)\n\nclass ModelNew(nn.Module):\n    def __init__(self, in_channels, out_channels, kernel_size, divisor, pool_size, bias_shape, sum_dim):\n        super(ModelNew, self).__init__()\n        self.conv = nn.Conv3d(in_channels, out_channels, kernel_size)\n        self.divisor = divisor\n        self.max_pool = nn.MaxPool3d(pool_size)\n        self.bias = nn.Parameter(torch.randn(bias_shape))\n        self.sum_dim = sum_dim\n\n    def forward(self, x):\n        x = self.conv(x)\n        x = x / self.divisor\n        x = self.max_pool(x)\n        \n        batch, C, D, H, W = x.shape\n        avg_out = torch.empty((batch, C), device=x.device, dtype=x.dtype)\n        grid = (batch, C)\n        _global_avg_pool3d[grid](\n            x, avg_out,\n            batch, C, D, H, W,\n            x.stride(0), x.stride(1), x.stride(2), x.stride(3), x.stride(4),\n            BLOCK_SIZE=1\n        )\n        \n        bias_reshaped = self.bias.view(C)\n        x = avg_out + bias_reshaped\n        x = x.sum(dim=self.sum_dim, keepdim=True)\n        x = x.view(batch, 1, 1, 1)\n        return x\n\nbatch_size = 128\nin_channels = 3\nout_channels = 16\ndepth, height, width = 16, 32, 32\nkernel_size = (3, 3, 3)\ndivisor = 2.0\npool_size = (2, 2, 2)\nbias_shape = (out_channels, 1, 1, 1)\nsum_dim = 1\n\ndef get_inputs():\n    return [torch.randn(batch_size, in_channels, depth, height, width)]\n\ndef get_init_inputs():\n    return [in_channels, out_channels, kernel_size, divisor, pool_size, bias_shape, sum_dim]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "98cdfceb-94b5-4f00-83c9-f5cde542afcd", "generation": 1, "timestamp": 1754579135.6054382, "iteration_found": 3, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.12, "runtime_ms": 0.887, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:7", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.106, "speed_up": 0.12, "custom_timing": 0.887}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "reference code", "passed": false, "score": 0.0, "speed_up": 1.0, "runtime_ms": 0.717, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:1", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.106, "speed_up": 0.148, "custom_timing": 0.717}}, "island": 2}, "artifacts_json": null, "artifact_dir": null}