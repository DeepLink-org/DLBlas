{"id": "d22b7ce4-4aab-4ae9-a41d-10a2697737d6", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef avg_pool1d_kernel(\n    x_ptr,\n    output_ptr,\n    input_length,\n    output_length,\n    kernel_size: tl.constexpr,\n    stride: tl.constexpr,\n    padding: tl.constexpr,\n    in_channels,\n    batch_size,\n    x_batch_stride,\n    x_channel_stride,\n    x_length_stride,\n    output_batch_stride,\n    output_channel_stride,\n    output_length_stride,\n):\n    pid = tl.program_id(0)\n    if pid >= batch_size * in_channels:\n        return\n\n    batch_idx = pid // in_channels\n    channel_idx = pid % in_channels\n\n    x_batch_start = x_ptr + batch_idx * x_batch_stride\n    x_channel_start = x_batch_start + channel_idx * x_channel_stride\n    \n    output_batch_start = output_ptr + batch_idx * output_batch_stride\n    output_channel_start = output_batch_start + channel_idx * output_channel_stride\n\n    for j in range(output_length):\n        start_idx = j * stride - padding\n        window = tl.arange(0, kernel_size)\n        indices = start_idx + window\n        mask = (indices >= 0) & (indices < input_length)\n        values = tl.load(\n            x_channel_start + indices * x_length_stride,\n            mask=mask,\n            other=0.0\n        )\n        total = tl.sum(values)\n        avg = total / kernel_size\n        tl.store(output_channel_start + j * output_length_stride, avg)\n\nclass ModelNew(nn.Module):\n    def __init__(self, kernel_size: int, stride: int = 1, padding: int = 0):\n        super(ModelNew, self).__init__()\n        self.kernel_size = kernel_size\n        self.stride = stride\n        self.padding = padding\n\n    def forward(self, x: torch.Tensor) -> torch.Tensor:\n        batch_size, in_channels, input_length = x.shape\n        output_length = (input_length + 2 * self.padding - self.kernel_size) // self.stride + 1\n        \n        if output_length <= 0:\n            return torch.empty((batch_size, in_channels, 0), device=x.device, dtype=x.dtype)\n        \n        x = x.contiguous()\n        output = torch.empty((batch_size, in_channels, output_length), device=x.device, dtype=x.dtype)\n        \n        grid = (batch_size * in_channels,)\n        avg_pool1d_kernel[grid](\n            x, output,\n            input_length,\n            output_length,\n            self.kernel_size,\n            self.stride,\n            self.padding,\n            in_channels,\n            batch_size,\n            x.stride(0), x.stride(1), x.stride(2),\n            output.stride(0), output.stride(1), output.stride(2)\n        )\n        return output\n\nbatch_size = 16\nin_channels = 32\ninput_length = 128\nkernel_size = 4\nstride = 2\npadding = 1\n\ndef get_inputs():\n    x = torch.randn(batch_size, in_channels, input_length)\n    return [x]\n\ndef get_init_inputs():\n    return [kernel_size, stride, padding]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "a790f50f-8563-4539-a65b-84d0d9fca0be", "generation": 1, "timestamp": 1754644303.9306996, "iteration_found": 14, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.611, "runtime_ms": 0.0504, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:2", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0308, "speed_up": 0.611, "custom_timing": 0.0504}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "reference code", "passed": false, "score": 0.0, "speed_up": 1.0, "runtime_ms": 0.0215, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:2", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0308, "speed_up": 1.433, "custom_timing": 0.0215}}, "island": 2}, "artifacts_json": null, "artifact_dir": null}