{"id": "98837207-a73e-45a1-8a37-b7957c2ef725", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef fused_mean_relu_kernel(\n    x_ptr,\n    output_ptr,\n    n_cols,\n    BLOCK_SIZE: tl.constexpr,\n):\n    row_idx = tl.program_id(0)\n    x_offset = row_idx * n_cols\n    col_offsets = tl.arange(0, BLOCK_SIZE)\n    mask = col_offsets < n_cols\n    \n    # Load input with boundary checks\n    x = tl.load(x_ptr + x_offset + col_offsets, mask=mask, other=0.0)\n    \n    # Compute mean using efficient reduction\n    row_sum = tl.sum(x, axis=0)\n    mean_val = row_sum / n_cols\n    \n    # Apply ReLU and store result\n    result = tl.where(mean_val > 0, mean_val, 0.0)\n    tl.store(output_ptr + row_idx, result)\n\ndef fused_mean_relu(x: torch.Tensor) -> torch.Tensor:\n    n_rows, n_cols = x.shape\n    output = torch.empty(n_rows, 1, device=x.device, dtype=x.dtype)\n    \n    # Configure kernel grid and block size\n    grid = (n_rows,)\n    block_size = triton.next_power_of_2(n_cols)\n    fused_mean_relu_kernel[grid](x, output, n_cols, BLOCK_SIZE=block_size)\n    \n    return output\n\nclass ModelNew(nn.Module):\n    def __init__(self, in_features, out_features, num_groups):\n        super(ModelNew, self).__init__()\n        self.gemm = nn.Linear(in_features, out_features)\n        self.batch_norm = nn.BatchNorm1d(out_features)\n        self.group_norm = nn.GroupNorm(num_groups, out_features)\n\n    def forward(self, x):\n        x = self.gemm(x)\n        x = self.batch_norm(x)\n        x = torch.nn.functional.gelu(x)\n        x = self.group_norm(x)\n        x = fused_mean_relu(x)  # Replaces mean + ReLU with fused kernel\n        return x\n\nbatch_size = 128\nin_features = 512\nout_features = 1024\nnum_groups = 8\n\ndef get_inputs():\n    return [torch.randn(batch_size, in_features)]\n\ndef get_init_inputs():\n    return [in_features, out_features, num_groups]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "88416bcd-96f2-425e-a70d-293fc3d77c1c", "generation": 1, "timestamp": 1754572183.2078536, "iteration_found": 3, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.739, "runtime_ms": 0.161, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:2", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.119, "speed_up": 0.739, "custom_timing": 0.161}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "reference code", "passed": false, "score": 0.0, "speed_up": 1.0, "runtime_ms": 0.143, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:7", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.119, "speed_up": 0.832, "custom_timing": 0.143}}, "island": 0}, "artifacts_json": null, "artifact_dir": null}