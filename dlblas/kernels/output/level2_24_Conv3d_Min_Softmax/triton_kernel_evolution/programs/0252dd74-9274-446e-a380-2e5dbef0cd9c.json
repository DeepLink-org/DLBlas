{"id": "0252dd74-9274-446e-a380-2e5dbef0cd9c", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef min_reduction_kernel(\n    input_ptr,\n    output_ptr,\n    reduction_size,\n    BLOCK_SIZE_R: tl.constexpr,\n):\n    row_idx = tl.program_id(0)\n    row_start = row_idx * reduction_size\n    min_val = float('inf')\n    for k in range(0, reduction_size, BLOCK_SIZE_R):\n        offsets = k + tl.arange(0, BLOCK_SIZE_R)\n        mask = offsets < reduction_size\n        current = tl.load(input_ptr + row_start + offsets, mask=mask, other=float('inf'))\n        current_min = tl.min(tl.where(mask, current, float('inf')), axis=0)\n        min_val = tl.minimum(min_val, current_min)\n    tl.store(output_ptr + row_idx, min_val)\n\n@triton.jit\ndef softmax_kernel(\n    input_ptr,\n    output_ptr,\n    n_cols,\n    BLOCK_SIZE: tl.constexpr,\n):\n    row_idx = tl.program_id(0)\n    row_start = row_idx * n_cols\n    offsets = row_start + tl.arange(0, BLOCK_SIZE)\n    mask = tl.arange(0, BLOCK_SIZE) < n_cols\n    row = tl.load(input_ptr + offsets, mask=mask, other=-float('inf'))\n    row_minus_max = row - tl.max(row, axis=0)\n    numerator = tl.exp(row_minus_max)\n    denominator = tl.sum(numerator, axis=0)\n    softmax_out = numerator / denominator\n    tl.store(output_ptr + offsets, softmax_out, mask=mask)\n\nclass ModelNew(nn.Module):\n    def __init__(self, in_channels, out_channels, kernel_size, dim):\n        super(ModelNew, self).__init__()\n        self.conv = nn.Conv3d(in_channels, out_channels, kernel_size)\n        self.dim = dim\n        self.out_channels = out_channels\n\n    def forward(self, x):\n        x = self.conv(x)\n        if not x.is_contiguous():\n            x = x.contiguous()\n        \n        if self.dim < 0:\n            dim = self.dim + x.dim()\n        else:\n            dim = self.dim\n        \n        reduction_dim_size = x.size(dim)\n        other_dims = list(x.shape)\n        del other_dims[dim]\n        total_non_reduction = x.numel() // reduction_dim_size\n        \n        x_2d = x.view(total_non_reduction, reduction_dim_size)\n        min_output_1d = torch.empty(total_non_reduction, device=x.device, dtype=x.dtype)\n        \n        grid_min = (total_non_reduction,)\n        min_reduction_kernel[grid_min](\n            x_2d,\n            min_output_1d,\n            reduction_dim_size,\n            BLOCK_SIZE_R=1024,\n        )\n        \n        min_output = min_output_1d.view(other_dims)\n        non_channel_dims = min_output.shape[0] * min_output.shape[2] * min_output.shape[3]\n        softmax_input = min_output.view(non_channel_dims, self.out_channels)\n        softmax_output = torch.empty_like(softmax_input)\n        \n        grid_softmax = (non_channel_dims,)\n        softmax_kernel[grid_softmax](\n            softmax_input,\n            softmax_output,\n            self.out_channels,\n            BLOCK_SIZE=triton.next_power_of_2(self.out_channels),\n        )\n        \n        return softmax_output.view(min_output.shape)\n\nbatch_size = 128\nin_channels = 3\nout_channels = 16\nD, H, W = 16, 32, 32\nkernel_size = 3\ndim = 2\n\ndef get_inputs():\n    return [torch.randn(batch_size, in_channels, D, H, W)]\n\ndef get_init_inputs():\n    return [in_channels, out_channels, kernel_size, dim]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "8838277c-0ec2-4154-9395-f946b8b13476", "generation": 1, "timestamp": 1754566705.2193236, "iteration_found": 4, "metrics": {"compiled": true, "correctness": false, "score": 10, "stage": "wrong_answer", "verify_payload": {"id": "level2_24_Conv3d_Min_Softmax", "result": {"compiled": true, "correctness": false, "metadata": {"hardware": "NVIDIA L20Y", "device": "cuda:3", "max_difference": ["0.149205", "0.153440", "0.157586", "0.167939", "0.162915"], "avg_difference": ["0.021326", "0.021312", "0.021321", "0.021280", "0.021322"], "correctness_issue": "Output mismatch", "correctness_trials": "(0 / 5)", "reference_timing_ms": 0.0599, "speed_up": -1.0, "custom_timing": -1.0}, "runtime": -1.0, "runtime_stats": {}}}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "reference code", "passed": false, "score": 0.0, "speed_up": 1.0, "runtime_ms": 0.588, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:5", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0599, "speed_up": 0.102, "custom_timing": 0.588}}, "island": 0}, "artifacts_json": null, "artifact_dir": null}