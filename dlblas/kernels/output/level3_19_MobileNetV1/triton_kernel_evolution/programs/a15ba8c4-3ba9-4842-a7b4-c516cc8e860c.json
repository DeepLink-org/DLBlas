{"id": "a15ba8c4-3ba9-4842-a7b4-c516cc8e860c", "code": "import math\nimport torch\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef global_avg_pool_kernel(\n    input_ptr, \n    output_ptr,\n    input_batch_stride, \n    input_channel_stride, \n    input_height_stride, \n    input_width_stride,\n    output_batch_stride, \n    output_channel_stride,\n    height, \n    width,\n    BLOCK_SIZE: tl.constexpr\n):\n    pid_batch = tl.program_id(0)\n    pid_channel = tl.program_id(1)\n    \n    input_offset = pid_batch * input_batch_stride + pid_channel * input_channel_stride\n    spatial_size = height * width\n    thread_idx = tl.arange(0, BLOCK_SIZE)\n    num_steps = tl.cdiv(spatial_size, BLOCK_SIZE)\n    \n    acc = tl.zeros((1,), dtype=tl.float32)\n    for step in range(num_steps):\n        element_idx = step * BLOCK_SIZE + thread_idx\n        mask = element_idx < spatial_size\n        h = element_idx // width\n        w = element_idx % width\n        spatial_offset = h * input_height_stride + w * input_width_stride\n        ptr = input_ptr + input_offset + spatial_offset\n        value = tl.load(ptr, mask=mask, other=0.0)\n        acc += value\n    \n    total_sum = tl.sum(acc, axis=0)\n    channel_avg = total_sum / spatial_size\n    output_offset = pid_batch * output_batch_stride + pid_channel * output_channel_stride\n    tl.store(output_ptr + output_offset, channel_avg, mask=thread_idx == 0)\n\ndef global_avg_pool(input: torch.Tensor) -> torch.Tensor:\n    batch, channels, height, width = input.shape\n    output = torch.empty((batch, channels), device=input.device, dtype=input.dtype)\n    \n    if input.is_cuda:\n        BLOCK_SIZE = 1024\n        grid = (batch, channels)\n        global_avg_pool_kernel[grid](\n            input_ptr=input,\n            output_ptr=output,\n            input_batch_stride=input.stride(0),\n            input_channel_stride=input.stride(1),\n            input_height_stride=input.stride(2),\n            input_width_stride=input.stride(3),\n            output_batch_stride=output.stride(0),\n            output_channel_stride=output.stride(1),\n            height=height,\n            width=width,\n            BLOCK_SIZE=BLOCK_SIZE\n        )\n    else:\n        # CPU fallback\n        output = input.mean(dim=[2, 3])\n        \n    return output\n\nclass ModelNew:\n    def __init__(self):\n        pass\n\n    @staticmethod\n    def global_avg_pool(input: torch.Tensor) -> torch.Tensor:\n        return global_avg_pool(input)", "language": "python", "parent_id": "30bf6814-c055-4b13-ad59-5584f3e74036", "generation": 2, "timestamp": 1754585186.4645016, "iteration_found": 9, "metrics": {"compiled": false, "correctness": false, "score": 1, "stage": "compile_error", "compile_log": "ModelNew.__init__() takes 1 positional argument but 4 were given\nTraceback (most recent call last):\n  File \"/cpfs01/shared/llm_kernel/hujiakai/KernelLLM/validation_api_server/evaluator.py\", line 173, in _verification_worker\n    result: KernelExecResult = eval_kernel_against_ref(\n  File \"/cpfs01/shared/llm_kernel/hujiakai/KernelLLM/validation_api_server/helpers/evaluations.py\", line 484, in eval_kernel_against_ref\n    custom_model = ModelNew(*init_args, **init_kwargs)\nTypeError: ModelNew.__init__() takes 1 positional argument but 4 were given\n", "exec_log": "[Child] \u7ed1\u5b9a GPU 4, torch sees 1 device(s)\n\n[Exception]\nTraceback (most recent call last):\n  File \"/cpfs01/shared/llm_kernel/hujiakai/KernelLLM/validation_api_server/code_executor.py\", line 71, in _exec_worker\n    exec(textwrap.dedent(code_src), mod.__dict__)\n  File \"<string>\", line 7, in <module>\n  File \"/home/lijiaxing/.conda/envs/api/lib/python3.10/site-packages/triton/runtime/jit.py\", line 844, in jit\n    return decorator(fn)\n  File \"/home/lijiaxing/.conda/envs/api/lib/python3.10/site-packages/triton/runtime/jit.py\", line 832, in decorator\n    return JITFunction(\n  File \"/home/lijiaxing/.conda/envs/api/lib/python3.10/site-packages/triton/runtime/jit.py\", line 635, in __init__\n    self.starting_line_number = inspect.getsourcelines(fn)[1]\n  File \"/home/lijiaxing/.conda/envs/api/lib/python3.10/inspect.py\", line 1121, in getsourcelines\n    lines, lnum = findsource(object)\n  File \"/home/lijiaxing/.conda/envs/api/lib/python3.10/inspect.py\", line 958, in findsource\n    raise OSError('could not get source code')\nOSError: could not get source code\n", "exit_code": "1"}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": false, "correctness": false, "score": -100.0, "stage": "no_valid_triton_code", "feedback": "You need to generate real and valid triton code for the core function. The key word 'import triton' is not found."}, "island": 0}, "artifacts_json": null, "artifact_dir": null}