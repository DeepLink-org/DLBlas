{"id": "572e95ea-032f-406c-b3a8-6e4d5c780516", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef linear_kernel(\n    x_ptr, w_ptr, b_ptr, output_ptr,\n    input_size, output_size,\n    stride_x, stride_w, stride_b, stride_out,\n    BLOCK_SIZE: tl.constexpr,\n):\n    pid_batch = tl.program_id(0)\n    pid_output = tl.program_id(1)\n    \n    bias = tl.load(b_ptr + pid_output)\n    acc = 0.0\n    \n    for i in range(0, input_size, BLOCK_SIZE):\n        offs = i + tl.arange(0, BLOCK_SIZE)\n        mask = offs < input_size\n        \n        x_val = tl.load(x_ptr + pid_batch * stride_x + offs, mask=mask, other=0.0)\n        w_val = tl.load(w_ptr + pid_output * stride_w + offs, mask=mask, other=0.0)\n        acc += tl.sum(x_val * w_val)\n    \n    acc += bias\n    tl.store(output_ptr + pid_batch * stride_out + pid_output, acc)\n\ndef triton_linear(x, weight, bias):\n    batch, input_size = x.shape\n    output_size = weight.shape[0]\n    output = torch.empty((batch, output_size), device=x.device, dtype=x.dtype)\n    \n    grid = (batch, output_size)\n    linear_kernel[grid](\n        x, weight, bias, output,\n        input_size, output_size,\n        x.stride(0), weight.stride(0), bias.stride(0), output.stride(0),\n        BLOCK_SIZE=64\n    )\n    return output\n\nclass ModelNew(nn.Module):\n    def __init__(self, input_size, hidden_size, num_layers, output_size, dropout=0.0):\n        super(ModelNew, self).__init__()\n        self.h0 = torch.randn((num_layers, batch_size, hidden_size))\n        self.c0 = torch.randn((num_layers, batch_size, hidden_size))\n        self.lstm = nn.LSTM(input_size, hidden_size, num_layers, batch_first=True, dropout=dropout, bidirectional=False)\n        self.fc_weight = nn.Parameter(torch.randn(output_size, hidden_size))\n        self.fc_bias = nn.Parameter(torch.randn(output_size))\n    \n    def forward(self, x):\n        self.h0 = self.h0.to(x.device)\n        self.c0 = self.c0.to(x.device)\n        \n        _, (hn, _) = self.lstm(x, (self.h0, self.c0))\n        last_out = hn[-1]\n        out = triton_linear(last_out, self.fc_weight, self.fc_bias)\n        \n        return out\n\n# Test code\nbatch_size = 10\nsequence_length = 512\ninput_size = 128\nhidden_size = 256\nnum_layers = 6\noutput_size = 10\ndropout = 0.0\n\ndef get_inputs():\n    return [torch.randn(batch_size, sequence_length, input_size)]\n\ndef get_init_inputs():\n    return [input_size, hidden_size, num_layers, output_size, dropout]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "9a665631-edce-4f2a-b2ca-7ab9f7aa6dc0", "generation": 1, "timestamp": 1754591299.2457848, "iteration_found": 3, "metrics": {"compiled": true, "correctness": false, "score": 10, "stage": "wrong_answer", "verify_payload": {"id": "level3_35_LTSM", "result": {"compiled": true, "correctness": false, "metadata": {"hardware": "NVIDIA L20Y", "device": "cuda:4", "max_difference": ["3.000115", "2.999539", "2.998030", "2.999840", "2.999262"], "avg_difference": ["0.919644", "0.919744", "0.919635", "0.919880", "0.919888"], "correctness_issue": "Output mismatch", "correctness_trials": "(0 / 5)", "reference_timing_ms": 26.0, "speed_up": -1.0, "custom_timing": -1.0}, "runtime": -1.0, "runtime_stats": {}}}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "reference code", "passed": false, "score": 0.0, "speed_up": 1.0, "runtime_ms": 23.0, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:3", "correctness_trials": "(5 / 5)", "reference_timing_ms": 26.0, "speed_up": 1.13, "custom_timing": 23.0}}, "island": 1}, "artifacts_json": null, "artifact_dir": null}