{"id": "8a1ffeee-ee0d-44a3-a85d-305fbd8e3546", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport math\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef _forward_kernel(\n    x_ptr, \n    v_ptr, \n    output_ptr, \n    scaling_factor,\n    input_size: tl.constexpr,\n    BLOCK_SIZE: tl.constexpr,\n    batch_size: tl.constexpr\n):\n    pid = tl.program_id(0)\n    if pid >= batch_size:\n        return\n        \n    # Load entire row at once\n    row_start = pid * input_size\n    col_offsets = tl.arange(0, BLOCK_SIZE)\n    mask = col_offsets < input_size\n    x_vals = tl.load(x_ptr + row_start + col_offsets, mask=mask, other=0.0)\n    v_vals = tl.load(v_ptr + col_offsets, mask=mask, other=0.0)\n    \n    # Fused multiply-add and scaling\n    acc = tl.sum(x_vals * v_vals) * (scaling_factor / 2.0)\n    tl.store(output_ptr + pid, acc)\n\nclass ModelNew(nn.Module):\n    def __init__(self, input_size, hidden_size, scaling_factor):\n        super(ModelNew, self).__init__()\n        self.weight = nn.Parameter(torch.randn(hidden_size, input_size))\n        self.scaling_factor = scaling_factor\n        self.input_size = input_size\n\n    def forward(self, x):\n        v = self.weight.sum(dim=0)  # Precomputed vector\n        output = torch.empty(x.shape[0], device=x.device, dtype=torch.float32)\n        \n        # Launch Triton kernel\n        BLOCK_SIZE = triton.next_power_of_two(self.input_size)\n        grid = (x.shape[0],)\n        _forward_kernel[grid](\n            x, v, output, \n            self.scaling_factor, \n            self.input_size, \n            BLOCK_SIZE,\n            x.shape[0]\n        )\n        \n        return output.unsqueeze(1)\n\nbatch_size = 128\ninput_size = 10\nhidden_size = 20\nscaling_factor = 1.5\n\ndef get_inputs():\n    return [torch.randn(batch_size, input_size)]\n\ndef get_init_inputs():\n    return [input_size, hidden_size, scaling_factor]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "d8927c9c-951b-49ef-8eb3-0bad69117e95", "generation": 3, "timestamp": 1754569389.3134418, "iteration_found": 22, "metrics": {"compiled": true, "correctness": false, "score": 10, "stage": "wrong_answer", "verify_payload": {"id": "level2_14_Gemm_Divide_Sum_Scaling", "result": {"compiled": true, "correctness": false, "metadata": {"hardware": "NVIDIA L20Y", "device": "cuda:0", "runtime_error": "Traceback (most recent call last):\n  File \"/cpfs01/shared/llm_kernel/hujiakai/KernelLLM/validation_api_server/helpers/evaluations.py\", line 720, in run_and_check_correctness\n    output_new = model_new(*inputs)\n  File \"/home/lijiaxing/.conda/envs/api/lib/python3.10/site-packages/torch/nn/modules/module.py\", line 1773, in _wrapped_call_impl\n    return self._call_impl(*args, **kwargs)\n  File \"/home/lijiaxing/.conda/envs/api/lib/python3.10/site-packages/torch/nn/modules/module.py\", line 1784, in _call_impl\n    return forward_call(*args, **kwargs)\n  File \"/tmp/tmp7e6zyj2v.py\", line 45, in forward\n    BLOCK_SIZE = triton.next_power_of_two(self.input_size)\nAttributeError: module 'triton' has no attribute 'next_power_of_two'. Did you mean: 'next_power_of_2'?\n", "runtime_error_name": "builtins.AttributeError", "reference_timing_ms": 0.0556, "speed_up": -1.0, "custom_timing": -1.0}, "runtime": -1.0, "runtime_stats": {}}}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.903, "runtime_ms": 0.0616, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:5", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0556, "speed_up": 0.903, "custom_timing": 0.0616}}, "island": 0}, "artifacts_json": null, "artifact_dir": null}