{"id": "ddbc8d59-cabf-43da-8cbb-8fc44179879f", "code": "@triton.jit\ndef _fused_hardtanh_mean_tanh(\n    input_ptr,\n    output_ptr,\n    input_batch_stride, input_channel_stride, input_height_stride, input_width_stride,\n    output_batch_stride, output_channel_stride,\n    min_val, max_val,\n    H, W,\n    BLOCK_SIZE: tl.constexpr,\n):\n    # We have two program indices: batch and channel\n    pid_batch = tl.program_id(0)\n    pid_channel = tl.program_id(1)\n    total_elements = H * W\n\n    # Base pointer for the current channel in the current batch\n    base = pid_batch * input_batch_stride + pid_channel * input_channel_stride\n    accumulator = 0.0\n    # Loop over the spatial dimension in blocks\n    for i in range(0, total_elements, BLOCK_SIZE):\n        # Create an index for the current block\n        idx = i + tl.arange(0, BLOCK_SIZE)\n        mask = idx < total_elements\n        # Compute the 2D indices (h, w) for the current linear index\n        h = idx // W\n        w = idx % W\n        # Compute the offset for each element in the block\n        spatial_offset = h * input_height_stride + w * input_width_stride\n        # The pointer for the current block of data\n        ptr = input_ptr + base + spatial_offset\n        # Load the data with mask\n        val = tl.load(ptr, mask=mask, other=0.0)\n        # Apply hardtanh (clamp)\n        clamped = tl.minimum(tl.maximum(val, min_val), max_val)\n        # Sum the clamped values in this block\n        block_sum = tl.sum(clamped, axis=0)\n        accumulator += block_sum\n\n    # Compute the mean\n    mean_val = accumulator / total_elements\n    # Apply tanh\n    out_val = tl.math.tanh(mean_val)\n\n    # Compute the output offset: (batch, channel) -> output is (batch, channel, 1, 1)\n    output_offset = pid_batch * output_batch_stride + pid_channel * output_channel_stride\n    tl.store(output_ptr + output_offset, out_val)", "language": "python", "parent_id": "6829c0ab-6db8-4846-8bf8-189c0ee531e7", "generation": 1, "timestamp": 1754566660.7434757, "iteration_found": 7, "metrics": {"compiled": false, "correctness": false, "score": -100.0, "stage": "no_valid_triton_code", "feedback": "You need to generate real and valid triton code for the core function. The key word 'import triton' is not found."}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "reference code", "passed": false, "score": 0.0, "speed_up": 1.0, "runtime_ms": 0.17, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:1", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.165, "speed_up": 0.971, "custom_timing": 0.17}}, "island": 2}, "artifacts_json": null, "artifact_dir": null}