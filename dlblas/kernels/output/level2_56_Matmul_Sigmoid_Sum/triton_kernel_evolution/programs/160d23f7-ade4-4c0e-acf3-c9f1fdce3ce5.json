{"id": "160d23f7-ade4-4c0e-acf3-c9f1fdce3ce5", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport math\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef fused_kernel(\n    x_ptr,\n    w_ptr,\n    b_ptr,\n    output_ptr,\n    batch_size,\n    input_size,\n    hidden_size,\n    stride_x0, stride_x1,\n    stride_w0, stride_w1,\n    stride_b,\n    stride_out0, stride_out1,\n    BLOCK_K: tl.constexpr,\n    BLOCK_H: tl.constexpr,\n):\n    pid0 = tl.program_id(0)\n    \n    # Load input row\n    x_offsets = pid0 * stride_x0 + tl.arange(0, BLOCK_K)\n    x_mask = tl.arange(0, BLOCK_K) < input_size\n    x_row = tl.load(x_ptr + x_offsets, mask=x_mask, other=0.0)\n    \n    # Compute linear transformation\n    row_sum = 0.0\n    for j in range(0, hidden_size, BLOCK_H):\n        h_offsets = j + tl.arange(0, BLOCK_H)\n        h_mask = h_offsets < hidden_size\n        \n        # Load weight block\n        w_ptrs = w_ptr + h_offsets[:, None] * stride_w0 + tl.arange(0, BLOCK_K)[None, :] * stride_w1\n        w_block = tl.load(w_ptrs, mask=h_mask[:, None] & x_mask[None, :], other=0.0)\n        \n        # Compute partial dot product\n        partial_dot = tl.sum(x_row[None, :] * w_block, axis=1)\n        \n        # Load bias block\n        b_block = tl.load(b_ptr + h_offsets * stride_b, mask=h_mask, other=0.0)\n        \n        # Complete dot product + bias\n        dot = partial_dot + b_block\n        \n        # Apply sigmoid and accumulate with masking\n        y = tl.sigmoid(dot)\n        y = tl.where(h_mask, y, 0.0)  # Mask out padding units\n        row_sum += tl.sum(y, axis=0)\n    \n    # Store result\n    tl.store(output_ptr + pid0 * stride_out0, row_sum)\n\nclass ModelNew(nn.Module):\n    def __init__(self, input_size, hidden_size):\n        super().__init__()\n        self.linear = nn.Linear(input_size, hidden_size)\n        self.input_size = input_size\n        self.hidden_size = hidden_size\n\n    def forward(self, x):\n        x = x.contiguous()\n        weight = self.linear.weight.contiguous()\n        bias = self.linear.bias.contiguous()\n        \n        output = torch.empty(x.size(0), 1, device=x.device, dtype=x.dtype)\n        \n        # Compute block sizes\n        BLOCK_K = 2 ** math.ceil(math.log2(self.input_size))\n        BLOCK_H = min(128, triton.next_power_of_2(self.hidden_size))\n        \n        # Launch fused kernel\n        grid = (x.size(0),)\n        fused_kernel[grid](\n            x,\n            weight,\n            bias,\n            output,\n            x.size(0),\n            self.input_size,\n            self.hidden_size,\n            x.stride(0), x.stride(1),\n            weight.stride(0), weight.stride(1),\n            bias.stride(0),\n            output.stride(0), output.stride(1),\n            BLOCK_K=BLOCK_K,\n            BLOCK_H=BLOCK_H,\n            num_warps=4\n        )\n        return output\n\nbatch_size = 128\ninput_size = 10\nhidden_size = 20\n\ndef get_inputs():\n    return [torch.randn(batch_size, input_size)]\n\ndef get_init_inputs():\n    return [input_size, hidden_size]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "dceaa0cc-6731-49c7-a709-18cdd1eac242", "generation": 3, "timestamp": 1754573204.3864944, "iteration_found": 9, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.787, "runtime_ms": 0.0614, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:0", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0483, "speed_up": 0.787, "custom_timing": 0.0614}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": false, "score": 10, "stage": "wrong_answer", "verify_payload": {"id": "level2_56_Matmul_Sigmoid_Sum", "result": {"compiled": true, "correctness": false, "metadata": {"hardware": "NVIDIA L20Y", "device": "cuda:6", "max_difference": ["6.000002", "6.000003", "6.000002", "6.000002", "6.000002"], "avg_difference": ["6.000000", "6.000000", "6.000000", "6.000000", "6.000000"], "correctness_issue": "Output mismatch", "correctness_trials": "(0 / 5)", "reference_timing_ms": 0.0483, "speed_up": -1.0, "custom_timing": -1.0}, "runtime": -1.0, "runtime_stats": {}}}}, "island": 0}, "artifacts_json": null, "artifact_dir": null}