{"id": "39528397-b0df-4b12-a916-beaf54c9a8e4", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport math\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef fused_kernel(\n    x_ptr,\n    w_ptr,\n    b_ptr,\n    output_ptr,\n    batch_size,\n    input_size,\n    hidden_size,\n    stride_x0, stride_x1,\n    stride_w0, stride_w1,\n    stride_b,\n    stride_out0, stride_out1,\n    BLOCK_K: tl.constexpr,\n    BLOCK_H: tl.constexpr,\n):\n    pid0 = tl.program_id(0)\n    \n    # Load input row\n    x_offsets = pid0 * stride_x0 + tl.arange(0, BLOCK_K)\n    x_mask = tl.arange(0, BLOCK_K) < input_size\n    x_row = tl.load(x_ptr + x_offsets, mask=x_mask, other=0.0)\n    \n    row_sum = 0.0\n    # Process hidden units in chunks of BLOCK_H\n    for j in range(0, hidden_size, BLOCK_H):\n        # Create offsets for current hidden block\n        h_offsets = j + tl.arange(0, BLOCK_H)\n        mask_h = h_offsets < hidden_size\n        \n        # Load weight block for current chunk\n        w_ptrs = w_ptr + h_offsets[:, None] * stride_w0 + tl.arange(0, BLOCK_K)[None, :] * stride_w1\n        w_mask = mask_h[:, None] & x_mask[None, :]\n        w_block = tl.load(w_ptrs, mask=w_mask, other=0.0)\n        \n        # Load bias block for current chunk\n        b_ptrs = b_ptr + h_offsets * stride_b\n        b_block = tl.load(b_ptrs, mask=mask_h, other=0.0)\n        \n        # Compute dot product for current chunk\n        dot_block = tl.sum(x_row[None, :] * w_block, axis=1) + b_block\n        \n        # Apply sigmoid and accumulate\n        sig_block = tl.sigmoid(dot_block)\n        sig_block_masked = tl.where(mask_h, sig_block, 0.0)\n        row_sum += tl.sum(sig_block_masked)\n    \n    # Store result\n    tl.store(output_ptr + pid0 * stride_out0, row_sum)\n\nclass ModelNew(nn.Module):\n    def __init__(self, input_size, hidden_size):\n        super().__init__()\n        self.linear = nn.Linear(input_size, hidden_size)\n        self.input_size = input_size\n        self.hidden_size = hidden_size\n\n    def forward(self, x):\n        x = x.contiguous()\n        weight = self.linear.weight.contiguous()\n        bias = self.linear.bias.contiguous()\n        \n        output = torch.empty(x.size(0), 1, device=x.device, dtype=x.dtype)\n        \n        # Compute block sizes\n        BLOCK_K = triton.next_power_of_2(self.input_size)\n        BLOCK_H = 8  # Fixed chunk size for hidden dimension\n        \n        # Launch fused kernel\n        grid = (x.size(0),)\n        fused_kernel[grid](\n            x,\n            weight,\n            bias,\n            output,\n            x.size(0),\n            self.input_size,\n            self.hidden_size,\n            x.stride(0), x.stride(1),\n            weight.stride(0), weight.stride(1),\n            bias.stride(0),\n            output.stride(0), output.stride(1),\n            BLOCK_K=BLOCK_K,\n            BLOCK_H=BLOCK_H\n        )\n        return output\n\nbatch_size = 128\ninput_size = 10\nhidden_size = 20\n\ndef get_inputs():\n    return [torch.randn(batch_size, input_size)]\n\ndef get_init_inputs():\n    return [input_size, hidden_size]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "fc341538-506b-49a2-8be2-844c3aa8daeb", "generation": 4, "timestamp": 1754576600.9665294, "iteration_found": 26, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.758, "runtime_ms": 0.0637, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:0", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0483, "speed_up": 0.758, "custom_timing": 0.0637}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.827, "runtime_ms": 0.0584, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:5", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0483, "speed_up": 0.827, "custom_timing": 0.0584}}, "island": 1}, "artifacts_json": null, "artifact_dir": null}