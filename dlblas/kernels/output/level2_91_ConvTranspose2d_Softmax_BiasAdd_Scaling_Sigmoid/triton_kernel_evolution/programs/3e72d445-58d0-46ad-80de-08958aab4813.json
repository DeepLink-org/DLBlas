{"id": "3e72d445-58d0-46ad-80de-08958aab4813", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef _fused_softmax_bias_scale_sigmoid(\n    input_ptr,\n    bias_ptr,\n    stride_n, stride_c, stride_h, stride_w,\n    H, W, C,\n    scaling_factor,\n    BLOCK_C: tl.constexpr,\n    VECTORS_PER_THREAD: tl.constexpr,\n):\n    pid = tl.program_id(0)\n    total_vectors = tl.num_programs(0)\n    base_idx = pid * VECTORS_PER_THREAD\n    for i in range(VECTORS_PER_THREAD):\n        vec_idx = base_idx + i\n        if vec_idx < total_vectors:\n            n_batch = vec_idx // (H * W)\n            remainder = vec_idx % (H * W)\n            h_idx = remainder // W\n            w_idx = remainder % W\n\n            base = input_ptr + n_batch * stride_n + h_idx * stride_h + w_idx * stride_w\n            c_offsets = tl.arange(0, BLOCK_C)\n            c_mask = c_offsets < C\n            x_ptrs = base + c_offsets * stride_c\n            x = tl.load(x_ptrs, mask=c_mask, other=-float('inf'))\n\n            bias = tl.load(bias_ptr + c_offsets, mask=c_mask, other=0)\n\n            max_val = tl.max(x, axis=0)\n            x_minus_max = x - max_val\n            exp_x = tl.exp(x_minus_max)\n            sum_exp = tl.sum(exp_x, axis=0)\n            softmax_out = exp_x / sum_exp\n\n            y = softmax_out + bias\n            y = y * scaling_factor\n            y = 1.0 / (1.0 + tl.exp(-y))\n\n            tl.store(x_ptrs, y, mask=c_mask)\n\nclass ModelNew(nn.Module):\n    def __init__(self, in_channels, out_channels, kernel_size, stride, padding, output_padding, bias_shape, scaling_factor):\n        super(ModelNew, self).__init__()\n        self.conv_transpose = nn.ConvTranspose2d(in_channels, out_channels, kernel_size, stride=stride, padding=padding, output_padding=output_padding)\n        self.bias = nn.Parameter(torch.randn(bias_shape)) \n        self.scaling_factor = scaling_factor\n\n    def forward(self, x):\n        x = self.conv_transpose(x)\n        batch_size, C, H, W = x.shape\n        total_vectors = batch_size * H * W\n        stride_n = x.stride(0)\n        stride_c = x.stride(1)\n        stride_h = x.stride(2)\n        stride_w = x.stride(3)\n        \n        BLOCK_C = triton.next_power_of_2(C)\n        VECTORS_PER_THREAD = 4\n        grid = (triton.cdiv(total_vectors, VECTORS_PER_THREAD),)\n        _fused_softmax_bias_scale_sigmoid[grid](\n            x, \n            self.bias, \n            stride_n, stride_c, stride_h, stride_w,\n            H, W, C,\n            self.scaling_factor,\n            BLOCK_C=BLOCK_C,\n            VECTORS_PER_THREAD=VECTORS_PER_THREAD,\n        )\n        return x\n\nbatch_size = 128\nin_channels = 32\nout_channels = 64\nheight, width = 16, 16\nkernel_size = 4\nstride = 2\npadding = 1\noutput_padding = 1\nbias_shape = (out_channels, 1, 1)\nscaling_factor = 2.0\n\ndef get_inputs():\n    return [torch.randn(batch_size, in_channels, height, width)]\n\ndef get_init_inputs():\n    return [in_channels, out_channels, kernel_size, stride, padding, output_padding, bias_shape, scaling_factor]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "827e2bed-917f-4723-b7a8-4dd65b66d81d", "generation": 2, "timestamp": 1754588254.553268, "iteration_found": 8, "metrics": {"compiled": true, "correctness": false, "score": 10, "stage": "wrong_answer", "verify_payload": {"id": "level2_91_ConvTranspose2d_Softmax_BiasAdd_Scaling_Sigmoid", "result": {"compiled": true, "correctness": false, "metadata": {"hardware": "NVIDIA L20Y", "device": "cuda:1", "max_difference": ["1.945826", "1.889967", "2.039871", "1.986812", "1.994857"], "avg_difference": ["0.396331", "0.396248", "0.396315", "0.396252", "0.396265"], "correctness_issue": "Output mismatch", "correctness_trials": "(0 / 5)", "reference_timing_ms": 0.0962, "speed_up": -1.0, "custom_timing": -1.0}, "runtime": -1.0, "runtime_stats": {}}}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.269, "runtime_ms": 0.357, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:0", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0962, "speed_up": 0.269, "custom_timing": 0.357}}, "island": 0}, "artifacts_json": null, "artifact_dir": null}