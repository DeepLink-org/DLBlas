{"id": "86d4f99a-d214-4c3b-8003-1cee7bfb21f8", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef fused_relu_bias_add(\n    input_ptr, bias_ptr, output_ptr,\n    n_elements,\n    spatial_size,\n    out_channels,\n    BLOCK_SIZE: tl.constexpr,\n):\n    # New 2D grid organization\n    pid0 = tl.program_id(0)  # batch*channel index\n    pid1 = tl.program_id(1)  # spatial block index\n    \n    # Compute channel and batch indices\n    channel_index = pid0 % out_channels\n    batch_index = pid0 // out_channels\n    \n    # Base pointer for current (batch, channel)\n    base = (batch_index * out_channels + channel_index) * spatial_size\n    spatial_offsets = pid1 * BLOCK_SIZE + tl.arange(0, BLOCK_SIZE)\n    mask = spatial_offsets < spatial_size\n    \n    # Load input\n    x = tl.load(input_ptr + base + spatial_offsets, mask=mask, other=0.0)\n    \n    # Fused ReLU\n    zero = 0.0\n    relu_x = tl.where(x > zero, x, zero)\n    \n    # Load bias once per channel and broadcast\n    bias_val = tl.load(bias_ptr + channel_index)\n    result = relu_x + bias_val\n    \n    # Store results\n    tl.store(output_ptr + base + spatial_offsets, result, mask=mask)\n\nclass ModelNew(nn.Module):\n    def __init__(self, in_channels, out_channels, kernel_size, bias_shape):\n        super(ModelNew, self).__init__()\n        self.conv = nn.Conv2d(in_channels, out_channels, kernel_size)\n        self.bias = nn.Parameter(torch.randn(bias_shape)) \n        \n    def forward(self, x):\n        x = self.conv(x)\n        output = torch.empty_like(x)\n        batch_size, out_channels, height, width = x.shape\n        spatial_size = height * width\n        total_batch_channels = batch_size * out_channels\n        \n        # New 2D grid configuration\n        grid = (total_batch_channels, triton.cdiv(spatial_size, 1024))\n        fused_relu_bias_add[grid](\n            x, \n            self.bias.view(-1), \n            output,\n            x.numel(),\n            spatial_size,\n            out_channels,\n            BLOCK_SIZE=1024\n        )\n        return output\n\nbatch_size = 128\nin_channels = 3\nout_channels = 16\nheight, width = 32, 32\nkernel_size = 3\nbias_shape = (out_channels, 1, 1)\n\ndef get_inputs():\n    return [torch.randn(batch_size, in_channels, height, width)]\n\ndef get_init_inputs():\n    return [in_channels, out_channels, kernel_size, bias_shape]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "30ce4105-9584-40ac-ad18-07a9e4cbeb22", "generation": 3, "timestamp": 1754571971.1017554, "iteration_found": 28, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.827, "runtime_ms": 0.0816, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:2", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0675, "speed_up": 0.827, "custom_timing": 0.0816}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.792, "runtime_ms": 0.0852, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:0", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0675, "speed_up": 0.792, "custom_timing": 0.0852}}, "island": 0}, "artifacts_json": null, "artifact_dir": null}