{"id": "a98b3b2f-f5c2-460e-8547-d4489a17abae", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.autotune(\n    configs=[\n        triton.Config({}, num_warps=1),\n        triton.Config({}, num_warps=2),\n        triton.Config({}, num_warps=4),\n        triton.Config({}, num_warps=8),\n    ],\n    key=['outer_numel', 'inner_numel', 'reduced_size'],\n)\n@triton.jit\ndef mean_reduce_kernel(\n    x_ptr,\n    output_ptr,\n    outer_numel,\n    inner_numel,\n    reduced_size,\n    stride_reduce,\n    BLOCK_SIZE: tl.constexpr,\n    VEC_SIZE: tl.constexpr,\n):\n    pid_outer = tl.program_id(0)\n    pid_inner = tl.program_id(1)\n    \n    inner_idx = pid_inner * BLOCK_SIZE + tl.arange(0, BLOCK_SIZE)\n    mask = inner_idx < inner_numel\n    \n    base_ptr = x_ptr + pid_outer * reduced_size * stride_reduce + inner_idx\n    row_sum = tl.zeros((BLOCK_SIZE,), dtype=tl.float32)\n    \n    # Vectorized reduction with unrolling\n    for r in range(0, reduced_size, VEC_SIZE):\n        vec_mask = mask & (r + tl.arange(0, VEC_SIZE) < reduced_size)[:, None]\n        ptrs = base_ptr + r * stride_reduce + tl.arange(0, VEC_SIZE)[:, None] * stride_reduce\n        vec = tl.load(ptrs, mask=vec_mask, other=0.0, eviction_policy=\"evict_last\")\n        row_sum += tl.sum(vec, axis=0)\n    \n    # Handle remainder elements\n    remainder_start = reduced_size - (reduced_size % VEC_SIZE)\n    for r in range(remainder_start, reduced_size):\n        ptrs = base_ptr + r * stride_reduce\n        elements = tl.load(ptrs, mask=mask, other=0.0)\n        row_sum += elements\n        \n    row_mean = row_sum / reduced_size\n    output_base = pid_outer * inner_numel + inner_idx\n    tl.store(output_ptr + output_base, row_mean, mask=mask)\n\nclass ModelNew(nn.Module):\n    def __init__(self, dim: int):\n        super(ModelNew, self).__init__()\n        self.dim = dim\n\n    def forward(self, x: torch.Tensor) -> torch.Tensor:\n        shape = x.shape\n        dim = self.dim\n        \n        # Compute dimensions\n        outer_dims = shape[:dim]\n        inner_dims = shape[dim+1:]\n        outer_numel = 1\n        for d in outer_dims:\n            outer_numel *= d\n        inner_numel = 1\n        for d in inner_dims:\n            inner_numel *= d\n        reduced_size = shape[dim]\n        \n        # Reshape and process\n        x_contig = x.contiguous().view(outer_numel, reduced_size, inner_numel)\n        output = torch.empty((outer_numel, inner_numel), device=x.device, dtype=x.dtype)\n        \n        # Launch kernel with optimized parameters\n        BLOCK_SIZE = 128\n        VEC_SIZE = 4\n        grid = (outer_numel, triton.cdiv(inner_numel, BLOCK_SIZE))\n        mean_reduce_kernel[grid](\n            x_contig, output, \n            outer_numel, inner_numel, reduced_size, inner_numel,\n            BLOCK_SIZE=BLOCK_SIZE,\n            VEC_SIZE=VEC_SIZE\n        )\n        \n        return output.view(*outer_dims, *inner_dims)\n\nbatch_size = 16\ndim1 = 256\ndim2 = 256\n\ndef get_inputs():\n    x = torch.randn(batch_size, dim1, dim2, device='cuda')\n    return [x]\n\ndef get_init_inputs():\n    return [1]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "a92c790b-6b73-417b-8f71-68b5a9f18199", "generation": 2, "timestamp": 1754645062.2031074, "iteration_found": 26, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.397, "runtime_ms": 0.0662, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:4", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0263, "speed_up": 0.397, "custom_timing": 0.0662}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.538, "runtime_ms": 0.0489, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:0", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0263, "speed_up": 0.538, "custom_timing": 0.0489}}, "island": 1}, "artifacts_json": null, "artifact_dir": null}