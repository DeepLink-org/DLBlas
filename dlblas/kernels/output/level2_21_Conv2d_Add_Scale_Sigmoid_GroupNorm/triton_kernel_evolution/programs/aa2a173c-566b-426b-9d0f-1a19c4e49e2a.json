{"id": "aa2a173c-566b-426b-9d0f-1a19c4e49e2a", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef _bias_scale_sigmoid_kernel(\n    input_ptr,\n    bias_ptr,\n    scale_ptr,\n    output_ptr,\n    n_channels,\n    spatial_size,\n    stride_n,\n    stride_c,\n    BLOCK_SIZE: tl.constexpr,\n):\n    pid = tl.program_id(0)\n    n_c = pid\n    n = n_c // n_channels\n    c = n_c % n_channels\n    base = n * stride_n + c * stride_c\n    \n    # Load bias and scale once per channel\n    bias_val = tl.load(bias_ptr + c)\n    scale_val = tl.load(scale_ptr + c)\n    \n    # Process spatial elements in blocks\n    for i in range(0, spatial_size, BLOCK_SIZE):\n        spatial_idx = i + tl.arange(0, BLOCK_SIZE)\n        mask = spatial_idx < spatial_size\n        offsets = base + spatial_idx\n        \n        # Load input, compute, and store output\n        x = tl.load(input_ptr + offsets, mask=mask, other=0.0)\n        x = (x + bias_val) * scale_val\n        x = tl.sigmoid(x)\n        tl.store(output_ptr + offsets, x, mask=mask)\n\nclass ModelNew(nn.Module):\n    def __init__(self, in_channels, out_channels, kernel_size, num_groups, bias_shape, scale_shape):\n        super(ModelNew, self).__init__()\n        self.conv = nn.Conv2d(in_channels, out_channels, kernel_size)\n        self.bias = nn.Parameter(torch.randn(bias_shape)) \n        self.scale = nn.Parameter(torch.randn(scale_shape))\n        self.group_norm = nn.GroupNorm(num_groups, out_channels)\n\n    def forward(self, x):\n        x = self.conv(x)\n        \n        # Get tensor dimensions\n        N, C, H, W = x.shape\n        spatial_size = H * W\n        \n        # Prepare output tensor\n        output = torch.empty_like(x)\n        \n        # Reshape parameters to 1D for kernel access\n        bias_1d = self.bias.view(C)\n        scale_1d = self.scale.view(C)\n        \n        # Calculate optimal block size\n        BLOCK_SIZE = min(triton.next_power_of_2(spatial_size), 1024)\n        \n        # Launch Triton kernel\n        grid = (N * C,)\n        _bias_scale_sigmoid_kernel[grid](\n            x, bias_1d, scale_1d, output,\n            C,\n            spatial_size,\n            x.stride(0),\n            x.stride(1),\n            BLOCK_SIZE=BLOCK_SIZE\n        )\n        \n        x = self.group_norm(output)\n        return x\n\nbatch_size = 128\nin_channels = 3\nout_channels = 16\nheight, width = 32, 32\nkernel_size = 3\nnum_groups = 8\nbias_shape = (out_channels, 1, 1)\nscale_shape = (out_channels, 1, 1)\n\ndef get_inputs():\n    return [torch.randn(batch_size, in_channels, height, width)]\n\ndef get_init_inputs():\n    return [in_channels, out_channels, kernel_size, num_groups, bias_shape, scale_shape]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "cd349964-54bc-4791-9614-b91006185feb", "generation": 3, "timestamp": 1754570342.754598, "iteration_found": 28, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.791, "runtime_ms": 0.129, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:1", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.102, "speed_up": 0.791, "custom_timing": 0.129}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.756, "runtime_ms": 0.135, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:7", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.102, "speed_up": 0.756, "custom_timing": 0.135}}, "island": 1}, "artifacts_json": null, "artifact_dir": null}