{"id": "76fcab20-1258-4281-96be-a5ffd42a9637", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef _pointwise_fused_kernel(\n    x_ptr, bias_ptr, scale_ptr, output_ptr,\n    channels, height, width,\n    stride_xn, stride_xc, stride_xh, stride_xw,\n    stride_bias_c, stride_scale_c,\n    BLOCK_SIZE: tl.constexpr\n):\n    pid = tl.program_id(0)\n    num_spatial = height * width\n    n = pid // num_spatial\n    hw = pid % num_spatial\n    h = hw // width\n    w = hw % width\n\n    c_offs = tl.arange(0, BLOCK_SIZE)\n    for c_block in range(0, channels, BLOCK_SIZE):\n        c_mask = c_offs < (channels - c_block)\n        bias = tl.load(bias_ptr + (c_block + c_offs) * stride_bias_c, mask=c_mask, other=0.0)\n        scale = tl.load(scale_ptr + (c_block + c_offs) * stride_scale_c, mask=c_mask, other=0.0)\n        x_ptrs = x_ptr + n * stride_xn + (c_block + c_offs) * stride_xc + h * stride_xh + w * stride_xw\n        x_val = tl.load(x_ptrs, mask=c_mask, other=0.0)\n\n        out_val = (x_val + bias) * scale\n        out_val = tl.sigmoid(out_val)\n\n        output_ptrs = output_ptr + n * stride_xn + (c_block + c_offs) * stride_xc + h * stride_xh + w * stride_xw\n        tl.store(output_ptrs, out_val, mask=c_mask)\n\nclass ModelNew(nn.Module):\n    def __init__(self, in_channels, out_channels, kernel_size, num_groups, bias_shape, scale_shape):\n        super(ModelNew, self).__init__()\n        self.conv = nn.Conv2d(in_channels, out_channels, kernel_size)\n        self.bias = nn.Parameter(torch.randn(bias_shape)) \n        self.scale = nn.Parameter(torch.randn(scale_shape))\n        self.group_norm = nn.GroupNorm(num_groups, out_channels)\n\n    def forward(self, x):\n        x = self.conv(x)\n        \n        N, C, H, W = x.shape\n        x_contig = x.contiguous()\n        bias_contig = self.bias.contiguous()\n        scale_contig = self.scale.contiguous()\n        output = torch.empty_like(x_contig)\n        \n        grid = (N * H * W,)\n        BLOCK_SIZE = 128\n        _pointwise_fused_kernel[grid](\n            x_contig, bias_contig, scale_contig, output,\n            C, H, W,\n            x_contig.stride(0), x_contig.stride(1), x_contig.stride(2), x_contig.stride(3),\n            bias_contig.stride(0), scale_contig.stride(0),\n            BLOCK_SIZE=BLOCK_SIZE\n        )\n        \n        x = self.group_norm(output)\n        return x\n\nbatch_size = 128\nin_channels = 3\nout_channels = 16\nheight, width = 32, 32\nkernel_size = 3\nnum_groups = 8\nbias_shape = (out_channels, 1, 1)\nscale_shape = (out_channels, 1, 1)\n\ndef get_inputs():\n    return [torch.randn(batch_size, in_channels, height, width)]\n\ndef get_init_inputs():\n    return [in_channels, out_channels, kernel_size, num_groups, bias_shape, scale_shape]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "cc99aa6a-0ad9-4b06-b38d-43bc86e63020", "generation": 3, "timestamp": 1754569309.6840537, "iteration_found": 21, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.593, "runtime_ms": 0.172, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:1", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.102, "speed_up": 0.593, "custom_timing": 0.172}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": false, "score": 10, "stage": "wrong_answer", "verify_payload": {"id": "level2_21_Conv2d_Add_Scale_Sigmoid_GroupNorm", "result": {"compiled": true, "correctness": false, "metadata": {"hardware": "NVIDIA L20Y", "device": "cuda:7", "max_difference": ["14.558603", "15.686123", "15.509394", "16.241442", "17.006855"], "avg_difference": ["0.024585", "0.024695", "0.024624", "0.024609", "0.024694"], "correctness_issue": "Output mismatch", "correctness_trials": "(0 / 5)", "reference_timing_ms": 0.102, "speed_up": -1.0, "custom_timing": -1.0}, "runtime": -1.0, "runtime_stats": {}}}}, "island": 2}, "artifacts_json": null, "artifact_dir": null}