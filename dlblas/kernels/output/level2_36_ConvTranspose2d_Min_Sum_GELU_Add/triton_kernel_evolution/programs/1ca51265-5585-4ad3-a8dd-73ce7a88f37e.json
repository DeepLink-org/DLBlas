{"id": "1ca51265-5585-4ad3-a8dd-73ce7a88f37e", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\nimport math\n\n@triton.jit\ndef _forward_kernel(\n    T_ptr, \n    bias_ptr, \n    output_ptr,\n    B, \n    C, \n    H, \n    W,\n    T_stride_b, \n    T_stride_c, \n    T_stride_h, \n    T_stride_w,\n    output_stride_b, \n    output_stride_c, \n    output_stride_w,\n    BLOCK_C: tl.constexpr,\n    dtype: tl.constexpr,\n):\n    pid_batch = tl.program_id(0)\n    pid_w = tl.program_id(1)\n    \n    if pid_batch >= B or pid_w >= W:\n        return\n    \n    # Vectorized channel indices\n    channel_idx = tl.arange(0, BLOCK_C)\n    channel_mask = channel_idx < C\n    \n    s = 0.0\n    for h in range(H):\n        # Vector load for all channels at (h, pid_w)\n        offs = pid_batch * T_stride_b + channel_idx * T_stride_c + h * T_stride_h + pid_w * T_stride_w\n        vec = tl.load(T_ptr + offs, mask=channel_mask, other=float('inf'))\n        min_val = tl.min(vec, axis=0)\n        s += min_val\n    \n    # Efficient GELU implementation\n    k = 0.7978845608028654  # sqrt(2/pi)\n    a = 0.044715\n    x3 = s * s * s\n    inner = k * (s + a * x3)\n    exp_inner = tl.exp(2 * inner)\n    tanh_inner = 1.0 - 2.0 / (exp_inner + 1.0)\n    base = 0.5 * s * (1.0 + tanh_inner)\n    \n    # Vectorized bias handling and output\n    bias_vec = tl.load(bias_ptr + channel_idx, mask=channel_mask, other=0)\n    out_vec = base + bias_vec\n    offs_out = pid_batch * output_stride_b + channel_idx * output_stride_c + pid_w * output_stride_w\n    tl.store(output_ptr + offs_out, out_vec, mask=channel_mask)\n\nclass ModelNew(nn.Module):\n    def __init__(self, in_channels, out_channels, kernel_size, stride, padding, output_padding, bias_shape):\n        super(ModelNew, self).__init__()\n        self.conv_transpose = nn.ConvTranspose2d(in_channels, out_channels, kernel_size, stride, padding, output_padding)\n        self.bias = nn.Parameter(torch.randn(bias_shape))\n        \n    def forward(self, x):\n        x = self.conv_transpose(x)\n        B, C, H, W = x.shape\n        output = torch.empty(B, C, 1, W, device=x.device, dtype=x.dtype)\n        \n        T_stride_b = x.stride(0)\n        T_stride_c = x.stride(1)\n        T_stride_h = x.stride(2)\n        T_stride_w = x.stride(3)\n        \n        output_stride_b = output.stride(0)\n        output_stride_c = output.stride(1)\n        output_stride_w = output.stride(3)\n        \n        bias_1d = self.bias.to(x.dtype).view(-1)\n        \n        grid = (B, W)\n        BLOCK_C = triton.next_power_of_2(C)\n        _forward_kernel[grid](\n            x, \n            bias_1d, \n            output,\n            B, C, H, W,\n            T_stride_b, T_stride_c, T_stride_h, T_stride_w,\n            output_stride_b, output_stride_c, output_stride_w,\n            BLOCK_C,\n            dtype=tl.float32 if x.dtype == torch.float32 else tl.float16\n        )\n        \n        return output\n\nbatch_size = 128\nin_channels = 3\nout_channels = 16\nheight, width = 32, 32\nkernel_size = 3\nstride = 2\npadding = 1\noutput_padding = 1\nbias_shape = (out_channels, 1, 1)\n\ndef get_inputs():\n    return [torch.randn(batch_size, in_channels, height, width)]\n\ndef get_init_inputs():\n    return [in_channels, out_channels, kernel_size, stride, padding, output_padding, bias_shape]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "7569a770-aa04-45a0-bf86-fe85f29427c5", "generation": 4, "timestamp": 1754568794.076701, "iteration_found": 16, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.591, "runtime_ms": 0.325, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:7", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.192, "speed_up": 0.591, "custom_timing": 0.325}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.351, "runtime_ms": 0.547, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:2", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.192, "speed_up": 0.351, "custom_timing": 0.547}}, "island": 0}, "artifacts_json": null, "artifact_dir": null}