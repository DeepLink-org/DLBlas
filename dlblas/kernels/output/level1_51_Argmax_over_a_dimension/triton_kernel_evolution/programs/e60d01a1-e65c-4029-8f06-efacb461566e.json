{"id": "e60d01a1-e65c-4029-8f06-efacb461566e", "code": "# ================== EVOLVE-BLOCK-START ==================\nimport torch\nimport torch.nn as nn\nimport triton\nimport triton.language as tl\n\n@triton.jit\ndef argmax_kernel(\n    x_ptr,\n    output_ptr,\n    d0,\n    d1,\n    d2,\n    stride0,\n    stride1,\n    stride2,\n    reduction_dim: tl.constexpr,\n    row_length: tl.constexpr,\n):\n    pid = tl.program_id(0)\n    if reduction_dim == 0:\n        idx1 = pid // d2\n        idx2 = pid % d2\n        base = idx1 * stride1 + idx2 * stride2\n        step = stride0\n    elif reduction_dim == 1:\n        idx0 = pid // d2\n        idx2 = pid % d2\n        base = idx0 * stride0 + idx2 * stride2\n        step = stride1\n    else:\n        idx0 = pid // d1\n        idx1 = pid % d1\n        base = idx0 * stride0 + idx1 * stride1\n        step = stride2\n\n    max_val = tl.load(x_ptr + base)\n    max_index = 0\n    for i in range(1, row_length):\n        offset = base + i * step\n        val = tl.load(x_ptr + offset)\n        if val > max_val:\n            max_val = val\n            max_index = i\n\n    tl.store(output_ptr + pid, max_index)\n\nclass ModelNew(nn.Module):\n    def __init__(self, dim: int):\n        super(ModelNew, self).__init__()\n        self.dim = dim\n\n    def forward(self, x: torch.Tensor) -> torch.Tensor:\n        if x.dim() != 3 or self.dim not in [0, 1, 2]:\n            return torch.argmax(x, dim=self.dim)\n            \n        d0, d1, d2 = x.shape\n        strides = x.stride()\n        \n        if self.dim == 0:\n            output_shape = (d1, d2)\n            n = d0\n        elif self.dim == 1:\n            output_shape = (d0, d2)\n            n = d1\n        else:\n            output_shape = (d0, d1)\n            n = d2\n            \n        output = torch.empty(output_shape, device=x.device, dtype=torch.int64).contiguous()\n        grid = (output.numel(),)\n        \n        argmax_kernel[grid](\n            x, output,\n            d0, d1, d2,\n            strides[0], strides[1], strides[2],\n            reduction_dim=self.dim,\n            row_length=n\n        )\n        return output\n\nbatch_size = 16\ndim1 = 256\ndim2 = 256\n\ndef get_inputs():\n    x = torch.randn(batch_size, dim1, dim2)\n    return [x]\n\ndef get_init_inputs():\n    return [1]\n# =================== EVOLVE-BLOCK-END ===================", "language": "python", "parent_id": "d3c7b965-5626-4209-b39d-6e92e7e0958b", "generation": 3, "timestamp": 1754645240.2216387, "iteration_found": 23, "metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.26, "runtime_ms": 0.0838, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:6", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0218, "speed_up": 0.26, "custom_timing": 0.0838}}, "complexity": 0.0, "diversity": 0.0, "metadata": {"changes": "Full rewrite", "parent_metrics": {"compiled": true, "correctness": true, "stage": "success", "passed": false, "score": 20, "speed_up": 0.467, "runtime_ms": 0.0467, "meta": {"hardware": "NVIDIA L20Y", "device": "cuda:4", "correctness_trials": "(5 / 5)", "reference_timing_ms": 0.0218, "speed_up": 0.467, "custom_timing": 0.0467}}, "island": 2}, "artifacts_json": null, "artifact_dir": null}